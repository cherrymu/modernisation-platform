---
owner_slack: "#modernisation-platform"
title: Setting Accounts to be excluded from the Instance Scheduler
last_reviewed_on: 2025-01-15
review_in: 6 months
---

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NXTCMQ7ZX6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-NXTCMQ7ZX6');
</script>

# <%= current_page.data.title %>

## Background

There are some Modernisation Platform accounts that should be excluded from the Instance Scheduler: 

- Non-member accounts which do not have the cross-account role & policies added during deployment. Any attempt by the scheduler to access these accounts would fail with an AccessDenied error and as such they are excluded.

- Production member accounts. These are out of the scope of the scheduler to avoid loss of service availability.

- Those non-production member accounts that users have requested are skipped by the scheduler.

## How Instance Scheduler Determines which accounts are in scope

Previously, the Instance Scheduler used a variable containing all of the account names that were to be skipped, including non-member accounts. That method has been changed so instead of a "skip list", this information is obtained form the /environments/*.json files in the Modernisation Platform repository.

The scheduler parses the each of the json files & from that data can identify those accounts that are excluded, namely:

- If the "account-type" field is not "member"

- If the environment "name" is "production"

- The field "instance_scheduler_skip": ["true"] exists in the environment list for the account in question.

## Setting an Account to be skipped by the Scheduler

Below is an example of an account .json file with the scheduler skip field added:

```
{
  "account-type": "member",
  "environments": [
    {
      "name": "development",
      "access": [
        {
          "sso_group_name": "modernisation-platform",
          "level": "developer",
          "nuke": "rebuild"
        },
        ---
      ],
      "instance_scheduler_skip": ["true"]
    }
  ],
  "tags": {
    "application": "modernisation-platform",
     ---
  },
  "github-oidc-team-repositories": [""],
  "go-live-date": ""
}

```

## Checking whether an Account was Skipped

The workflow "Build-test-push" workflow of the Instance Scheduler [repository](https://github.com/ministryofjustice/modernisation-platform-instance-scheduler) will show the log output of any unit tests of the Go source and specifically details of any accounts that were excluded & why.

For example:

```
Account is of type member: nomis
extractNames - Found name: nomis.development
extractNames - Found name: nomis.test
extractNames - Skipping due to instance_scheduler_skip: nomis.preproduction
extractNames - Skipping due to production: nomis.production
```

## References:

- https://github.com/ministryofjustice/modernisation-platform-instance-scheduler